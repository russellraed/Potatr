<html manifest="potatr.appcache">
	<head>
		<script type="text/javascript" src="js/jquery-1.9.1.min.js" ></script>
		<script>
			var facebookId = null;
			var facebookToken = null;
			var url = "https://potatr-1038.appspot.com/_ah/api/potatr/v1";
		  	window.fbAsyncInit = function() {
		    	FB.init({
			      	appId      : '941437125898487',
			      	xfbml      : true,
			      	version    : 'v2.4'
		    	});

		    	$("#sign-in-button").click(function(){
		    		signIn();
		    	});

		    	FB.getLoginStatus(function(response) {
					if (response.status === 'connected') {
						facebookId = response.authResponse.userID;
						facebookToken = response.authResponse.accessToken;
		        	    //check status in our database
						console.log("authorized");
						getFacebookInfo();
					} else if (response.status === 'not_authorized') {
	        	    	//the user is logged in to Facebook, 
						//but has not authenticated your app
						console.log("not yet authorized");
						hideAllSteps();
						$("#facebook-logged-out").fadeIn();
					} else {
						hideAllSteps();
						$("#facebook-logged-out").fadeIn();
					}
				});
		  	};

		  	function hideAllSteps(){
				$("#facebook-logged-out").hide();
				$("#facebook-logged-in").hide();
			}

			function signIn(){
	    	  	FB.login(function(response) {
		        	  	console.log(response);
						if (response.authResponse) {
							console.log('Welcome!  Fetching your information.... ');
							getFacebookInfo();
						} else {
							console.log('User cancelled login or did not fully authorize.');
						}
					}, 
					{ scope: 'email' }
				);
	      	}

	      	function getFacebookInfo(){
				FB.api('/me?fields=email,gender,last_name,first_name,name', function(response) {
					console.log(response);
					hideAllSteps();

					$.ajax({
						method: "GET",
						url: url + "/profile/12345",
						success: function(data){
							console.log(data);

							/*
							var data = { 
								"id": response.id,
								"email": response.email, 
								"firstName": response.first_name, 
								"lastName": response.last_name, 
								"position": "", 
								"department": "", 
								"mobileNumber": "", 
								"officeNumber": "", 
								"officeAddress": "" 
							};
							console.log(data);

							$.ajax({
								method: "PUT",
								data: data,
								url: "https://potatr-1038.appspot.com/_ah/api/potatr/v1/profile/" + response.id,
								success: function(data){
									console.log(data)
									sessionStorage.user = data;
									window.location.href = "index.html";
								}
							});*/
						},
						error: function(err){

						}
					});

				});
			}

			(function(d, s, id){
				var js, fjs = d.getElementsByTagName(s)[0];
				if (d.getElementById(id)) {return;}
				js = d.createElement(s); js.id = id;
				js.src = "//connect.facebook.net/en_US/sdk.js";
				fjs.parentNode.insertBefore(js, fjs);
			}(document, 'script', 'facebook-jssdk'));
		</script>
	</head>
	<body>
		<div id="facebook-logged-out" layout="column" layout-align="center center" style="display: none;">
			<h2>Sign In to Potatr</h2>
			<p>You need to Sign In using Facebook to continue.</p>
			<a href="javascript:void(0)" id="sign-in-button" class="button x blue push">Sign In</a>
		</div>
	</body>
</html>